---
- hosts: http
  remote_user: root
  roles:
    - { role: authorized_keys, tags: "authorized_keys" }
    - { role: option-disk, tags: "option-disk" }
    - { role: convenience, tags: "convenience" }
    - { role: convenience-mail, tags: "convenience-mail" }
    - { role: convenience-yum, tags: "convenience-yum" }
    - { role: fail2ban, tags: "fail2ban" }
    - { role: letsencrypt-nginx-proxy, tags: "http-proxy" }
    - { role: http-proxy-home, tags: "http-proxy-home" }
#    - { role: ftp_ssh, tags: "ftp_ssh" }
    - { role: roadside_post, tags: "roadside_post" }
    - { role: http-static-ddns, tags: "ddns-client" }
    - { role: remote-logging, vars: { LOCAL_SYSLOG: '' }, tags: "remote-logging" }

- hosts: http
  remote_user: root
  vars:
    - VIRTUAL_HOST: hochzeit.gecius.de
    - BASIC_AUTH_USER: hochzeit
    - BASIC_AUTH_PASSWD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63313066646364393835643965376230376434646264356332386532323734613034346230646561
          6239303539346136353763376135356233373331383561350a663963636433326465396139623239
          36653134333331373836366132343935363333366666343230633661623764303133383162613061
          3333306539373564390a646134613631396133303465636463666233343031326561343033313232
          3430
  roles:
    - letsencrypt-nginx-proxy-basicauth
    - hochzeit
  tags: 
    - hochzeit

- hosts: http
  remote_user: root
  vars:
    MYSQL_DATABASE: piwigo
    MYSQL_USER: g2web
    MYSQL_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33666632656162306633623133663565393761393131376162666135653134386233376437393664
          3531653536363434353236646530613434633530346165340a333033373466313731636133393664
          62656661623536616234316364663030303664633634653638303466613231656465663534636161
          6562326635656638630a616565656333636265663332396435326537363166383664303432613732
          6130
    MYSQL_ROOT_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          62643138633739343061323438363065366338353433626333613437316562343763643734373334
          3631656333303438346431653438373437356631323435370a383666373062626565333166663839
          39353135666365346232623837323665373733616333663264666638363062643237386133623930
          3632333932376537650a333035366665373134623135636238323732613664656661633735613835
          3430
    VIRTUAL_HOST: gecius.de,piwigo.gecius.de,pwg.gecius.de,gallery.gecius.de
  roles:
    - mariadb_container
    - piwigo
  tags: 
    - piwigo

- hosts: http
  remote_user: root
  vars:
    MYSQL_DATABASE: piwigo11
    MYSQL_USER: g2web
    MYSQL_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33666632656162306633623133663565393761393131376162666135653134386233376437393664
          3531653536363434353236646530613434633530346165340a333033373466313731636133393664
          62656661623536616234316364663030303664633634653638303466613231656465663534636161
          6562326635656638630a616565656333636265663332396435326537363166383664303432613732
          6130
    MYSQL_ROOT_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          62643138633739343061323438363065366338353433626333613437316562343763643734373334
          3631656333303438346431653438373437356631323435370a383666373062626565333166663839
          39353135666365346232623837323665373733616333663264666638363062643237386133623930
          3632333932376537650a333035366665373134623135636238323732613664656661633735613835
          3430
    VIRTUAL_HOST: p11.gecius.de
  roles:
    - mariadb_container
    - piwigo_test
  tags: 
    - piwigo_test

#- hosts: http
#  remote_user: root
#  roles: 
#    - searx
#  vars:
#    VIRTUAL_HOST: searx.gecius.de
#  tags:
#    - searx

- hosts: http
  remote_user: root
  vars:
    MYSQL_DATABASE: squirrelmail
    MYSQL_USER: squirreluser
    MYSQL_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63316562353866616563316464613965316662393231333461666333393030663833633734633861
          6535653432613230373763643031333937656166656462360a656635326162663530353233316239
          32373433633237376264353666656635396464366431336361326535356431333262613962633336
          6263393634356561660a666336633433653863383931306337663834636466376261363338633262
          3461
    MYSQL_ROOT_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          62643138633739343061323438363065366338353433626333613437316562343763643734373334
          3631656333303438346431653438373437356631323435370a383666373062626565333166663839
          39353135666365346232623837323665373733616333663264666638363062643237386133623930
          3632333932376537650a333035366665373134623135636238323732613664656661633735613835
          3430
    VIRTUAL_HOST: mail.gecius.de,secure.gecius.de,webmail2.gecius.de,webmail.gecius.de
  roles:
    - mariadb_container
    - squirrelmail
  tags:
    - squirrelmail

- hosts: http
  remote_user: root
  vars:
    MYSQL_DATABASE: roundcube
    MYSQL_USER: roundcube
    MYSQL_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33656435616465633534376638313266313437356238356362663966636336643233303633336136
          3034343664336139326164316666396637616639633961650a623033626131396162313838323637
          31393033303666616436383064613034323231656532376563373161666164373364373164666632
          3161613863633031650a396338383562333033613766353262346565623663623262613130363131
          38666432356539323661336263373462346435373837643038623031666361303138
    MYSQL_ROOT_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34326337636634333937366162356330323266643438636265313237313365613431643333323965
          3732623032343139393332356638316232303166353335660a393330356664323939636662373334
          63316132393831313737636331363566636439383762346433386238396664336636396264343165
          3461656361656536640a373662303038616537643737623130323466303530323439616337313736
          33303161346236383938346361316135383866303534643432356437643137653339
    VIRTUAL_HOST: webmail1.gecius.de
  roles:
    - mariadb_container
    - roundcube
  tags:
    - roundcube

- hosts: http
  remote_user: root
  vars:
    MYSQL_DATABASE: 'nextcloud'
    MYSQL_HOST: 'mariadb_for_{{ MYSQL_DATABASE }}'
    MYSQL_USER: 'nextcloud'
    MYSQL_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34323564363265383136366639353532333565313266363534353962343962393330316437343031
          3032653637366663303233323365323130303933616364350a386162383635623061313066373163
          31343463323066353264303839646337343335623039396463356233363064366434323562333537
          3064666561376163330a613832643638303865646335383639626161633531343063613732616661
          63396232373262613832386566323531323838336432633863326136653266646431
    MYSQL_ROOT_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          62643138633739343061323438363065366338353433626333613437316562343763643734373334
          3631656333303438346431653438373437356631323435370a383666373062626565333166663839
          39353135666365346232623837323665373733616333663264666638363062643237386133623930
          3632333932376537650a333035366665373134623135636238323732613664656661633735613835
          3430
    NC_REDIS_HOST: 'redis_for_nextcloud'
    REDIS_CONTAINER_NAME: '{{ NC_REDIS_HOST }}'
    NC_MAIL_HOST: 'mail2.gecius.de'
    NC_MAIL_USER: 'nextcloud@gecius.de'
    NC_MAIL_PORT: '587'
    NC_DOMAIN: 'gecius.de'
    NC_MAJOR: '20'
    NC_MAIL_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36333365363461303035623931313462353535396430303539626639393430633564306263623131
          3265343033646464643335363934393230393832326563390a303061336261366134373638623862
          34376334316234656261323331333033616331373662323330623434373662383338353965343138
          6466353435653065340a303638623262393363383064626364373236373135363131393438616632
          37306665633531346636343438376434613562646261303134626465303530333066
    NC_ADMIN_USER: 'admin'
    NC_ADMIN_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          65663133343566663161326161343933663033633162643861663930313136303939643433313663
          3863636536373531363731616662356664356165313466390a336634626335326633643537346339
          34653362326432656361613234386638653063656264653961616234306661656638363762333663
          3130663763396232340a303731343635306534303832613563663266616261363937323064353066
          63633664333839303963353030386430633439646136333835656365333137353566
    VIRTUAL_HOST: 'cal2.gecius.de,cloud.gecius.de'
  roles:
    - redis_container
    - mariadb_container
    - nextcloud_container
  tags:
    - nextcloud

- hosts: homeserver
  remote_user: root
  vars:
    sync_source_host_ansible: jens-http
    sync_source_host: jens-http
    sync_source: "/srv/nextcloud/nc_data/jens@gecius.de/files/SofortUpload/Camera/*"
    sync_target_dir: "/mnt/HomeSrv/Bilder/Phone/"
    sync_minutes: "15"
    sync: "rsync"
  roles:
    - { role: rompe.sync_dir_from_other_host, tags: "sync_dir" }
  tags:
    - nc_jens_sync

- hosts: http
  remote_user: root
  vars:
    MYSQL_DATABASE: 'postfix'
    MYSQL_HOST: '192.168.175.25'
    MYSQL_USER: 'postfixadmin'
    MYSQL_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39333839353363313765323030383266396135633834653164363633643032383230356563663934
          3365303638623266663634383737396336393033353432660a336638373664633263386661393263
          31336461396333343863653033333962613134383439393439656333346532326439653738653037
          3331336566616437330a666134343130336238316432623738366330616138373164656533623232
          3532
    SETUP_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36636332306630306230653533313165363264366231643635343663623234653434306366653631
          6135633164386431353065323337636535613934306432640a616636646464353031383139316361
          66663566653536353830613166623135303139373732646464373564613331306663333663333534
          3036376135316137320a326162313533306336303462333639666631636431616135323439643262
          6362
    VIRTUAL_HOST: 'pfa.gecius.de'
  roles:
    - postfixadmin
  tags:
    - postfixadmin

- hosts: http
  remote_user: root
  vars:
    VIRTUAL_HOST: vgrabbj.gecius.de
  roles:
    - nginx
  tags:
    vgrabbj.gecius.de

- hosts: http
  remote_user: root
  vars:
    VIRTUAL_HOST: nedoc.gecius.de,nedoc1.gecius.de
  roles:
    - nginx
  tags:
    nedoc.gecius.de

- hosts: http
  remote_user: root
  vars:
    VIRTUAL_HOST: mail2.gecius.de
  roles:
    - nginx
  tags:
    mail2.gecius.de

- hosts: http
  remote_user: root
  vars:
    MYSQL_DATABASE: mailman
    MYSQL_USER: mailman
    MYSQL_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37336630333563326362626136346331383465666537613734623539326138636231396239373737
          6332666530333332366230643231363238633436323137620a653366363863346363363131393230
          64623232343030356466346561313664346131383030356231373038636262326433623630616362
          3634356432653132350a363339626136363662373230356138353837396234323638633036363463
          3265
    MYSQL_ROOT_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          38633237393531633736653239353930323663363438343335303236303038353661663263373637
          3034313135376537613435393036663833376430333366640a653330323930333062363835353434
          30653137623164316563383163663863353734303431646234613766383032313538323536653737
          3866396239396664360a343735323534656132333035623364353431623634393465663462653034
          3666
    MMREST_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36396238626431363935643262326639386338333233373064376263306236613034326532663935
          6336616165656530383464663938646337666532613137330a373164343333623432393837356330
          66323462316332346666366466336137333465626138336266323236383664376263646663313839
          6362393530633266640a306366383739636233333334626130653730616235353030636363663033
          6332
  roles:
    - { role: mariadb_container, tags: mariadb_mailman_t }
    - { role: mailman_core, tags: mailman_core_t }
  tags:
    - mailman_core
    - mailman

- hosts: mail
  remote_user: root
  vars:
    sync_source_host_ansible: jens-http
    sync_source_host: 192.168.175.80
    sync_source: /srv/mailman_core/var/data
    sync_target_dir: /var/spool/postfix/
  roles:
    - { role: rompe.sync_dir_from_other_host, tags: "sync_dir" }
  tags:
    mm_alias_sync

- hosts: mail
  remote_user: root
  roles:
    - { role: mailman_postmap_cron, tags: "mm_postmap_cron" }

- hosts: http
  remote_user: root
  vars:
    MYSQL_DATABASE: mailman_web
    MYSQL_USER: mailman_web
    MYSQL_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64643566333031633639373538386566316235373465333037386566386637323638353361623066
          3131373539323861346464316462326631613738613861630a343231636361393263623566663930
          61626333363835306237366537303161333039653333646338393334623166633138636432326139
          6164663438353738650a643635306266656166646232643230383234613032353064346531376461
          6136
    MYSQL_ROOT_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          62643138633739343061323438363065366338353433626333613437316562343763643734373334
          3631656333303438346431653438373437356631323435370a383666373062626565333166663839
          39353135666365346232623837323665373733616333663264666638363062643237386133623930
          3632333932376537650a333035366665373134623135636238323732613664656661633735613835
          3430
    MMREST_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36396238626431363935643262326639386338333233373064376263306236613034326532663935
          6336616165656530383464663938646337666532613137330a373164343333623432393837356330
          66323462316332346666366466336137333465626138336266323236383664376263646663313839
          6362393530633266640a306366383739636233333334626130653730616235353030636363663033
          6332
    VIRTUAL_HOST: mm.gecius.de,lists.gecius.de,list.gecius.de
  roles:
    - { role: mariadb_container, tags: mariadb_mailmanweb_t }
    - { role: mailman_web, tags: mailman_web_t }
  tags:
    - mailman_web
    - mailman

- hosts: http
  user: root
  vars:
    VIRTUAL_HOST: prometheus.gecius.de
    BASIC_AUTH_USER: admin
    BASIC_AUTH_PASSWD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30386639353535646661363131396430653034636332633866646334356236393662623565333135
          3637386564656132366337653562393030373339313764380a666632326636646530643966326630
          65323339633537613362663664396338313733343930373636316130333135333066363665633664
          3031373665633733310a333561633836363262316362333032306262356339313166303263306661
          66343366313365663162616264316133303164393437346533663839666233663137
    NODE_EXPORTER_TARGETS: "['nodex-jens-other.gecius.de', 'nodex-jens-http.gecius.de', 'nodex-jens-mail.gecius.de']"
  roles:
    - letsencrypt-nginx-proxy-basicauth
    - prometheus_container
  tags:
    - prometheus

- hosts: http
  user: root
  vars:
    VIRTUAL_HOST: grafana.gecius.de
    BASIC_AUTH_USER: admin
    BASIC_AUTH_PASSWD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30386639353535646661363131396430653034636332633866646334356236393662623565333135
          3637386564656132366337653562393030373339313764380a666632326636646530643966326630
          65323339633537613362663664396338313733343930373636316130333135333066363665633664
          3031373665633733310a333561633836363262316362333032306262356339313166303263306661
          66343366313365663162616264316133303164393437346533663839666233663137
  roles:
    - letsencrypt-nginx-proxy-basicauth
    - grafana_container
  tags:
    - grafana

- hosts: http
  user: root
  vars:
    VIRTUAL_HOST: nodex-jens-http.gecius.de
    BASIC_AUTH_USER: admin
    BASIC_AUTH_PASSWD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30386639353535646661363131396430653034636332633866646334356236393662623565333135
          3637386564656132366337653562393030373339313764380a666632326636646530643966326630
          65323339633537613362663664396338313733343930373636316130333135333066363665633664
          3031373665633733310a333561633836363262316362333032306262356339313166303263306661
          66343366313365663162616264316133303164393437346533663839666233663137
  roles:
    - letsencrypt-nginx-proxy-basicauth
    - node_exporter_container
  tags:
    - node_exporter

- hosts: http
  user: root
  vars:
    VIRTUAL_HOST: "nodex-jens-mail.gecius.de"
    REMOTE_HOST: "192.168.175.25"
    REMOTE_PORT: "9100"
    BASIC_AUTH_USER: admin
    BASIC_AUTH_PASSWD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30386639353535646661363131396430653034636332633866646334356236393662623565333135
          3637386564656132366337653562393030373339313764380a666632326636646530643966326630
          65323339633537613362663664396338313733343930373636316130333135333066363665633664
          3031373665633733310a333561633836363262316362333032306262356339313166303263306661
          66343366313365663162616264316133303164393437346533663839666233663137
  roles:
    - letsencrypt-nginx-proxy-basicauth
    - port-forward
  tags:
    - node_exporter

- hosts: http
  user: root
  vars:
    VIRTUAL_HOST: "nodex-jens-other.gecius.de"
    REMOTE_HOST: "192.168.175.99"
    REMOTE_PORT: "9100"
    BASIC_AUTH_USER: admin
    BASIC_AUTH_PASSWD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30386639353535646661363131396430653034636332633866646334356236393662623565333135
          3637386564656132366337653562393030373339313764380a666632326636646530643966326630
          65323339633537613362663664396338313733343930373636316130333135333066363665633664
          3031373665633733310a333561633836363262316362333032306262356339313166303263306661
          66343366313365663162616264316133303164393437346533663839666233663137
  roles:
    - letsencrypt-nginx-proxy-basicauth
    - port-forward
  tags:
    - node_exporter

- hosts: http
  user: root
  vars:
    VIRTUAL_HOST: "dockerx-jens-mail.gecius.de"
    REMOTE_HOST: "192.168.175.25"
    REMOTE_PORT: "9323"
    BASIC_AUTH_USER: admin
    BASIC_AUTH_PASSWD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30386639353535646661363131396430653034636332633866646334356236393662623565333135
          3637386564656132366337653562393030373339313764380a666632326636646530643966326630
          65323339633537613362663664396338313733343930373636316130333135333066363665633664
          3031373665633733310a333561633836363262316362333032306262356339313166303263306661
          66343366313365663162616264316133303164393437346533663839666233663137
  roles:
    - letsencrypt-nginx-proxy-basicauth
    - port-forward
  tags:
    - docker_exporter

- hosts: http
  user: root
  roles:
    - sprit_png
  tags:
    - sprit_png
